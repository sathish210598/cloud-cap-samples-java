# Use Windows Server Core with Node.js pre-installed
FROM mcr.microsoft.com/windows/servercore:ltsc2022

# Set environment variables for Node.js
ENV NODE_VERSION=20.2.0
ENV NODE_DOWNLOAD_URL=https://nodejs.org/dist/v20.2.0/node-v20.2.0-win-x64.zip

# Set working directory
WORKDIR /app

# Download and extract Node.js
RUN powershell -Command `
    Invoke-WebRequest -Uri %NODE_DOWNLOAD_URL% -OutFile node.zip ; `
    Expand-Archive node.zip -DestinationPath C:\ ; `
    Rename-Item "C:\node-v$env:NODE_VERSION-win-x64" C:\nodejs ; `
    Remove-Item -Force node.zip

# Update PATH
ENV PATH="C:\\nodejs;C:\\nodejs\\bin;%PATH%"

# Copy app files
COPY . .

# Install dependencies
RUN npm install

# Expose the port (modify if needed)
EXPOSE 3000

# Command to run your app
CMD ["node", "index.js"]
